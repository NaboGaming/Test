<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
</head>
<body>
    <h1>Welcome to your Dashboard, <span id="userName"></span></h1>
    <p>Email: <span id="userEmail"></span></p>
    <img id="userProfilePicture" src="" alt="Profile Picture">
    <div>
        <label for="gameName">Game Name:</label>
        <input type="text" id="gameName">
        <label for="gameId">Game ID:</label>
        <input type="text" id="gameId">
    </div>
    <div>
        <p>Select your Squad:
            <button id="squad1" class="squadBtn">Squad 1</button>
            <button id="squad2" class="squadBtn">Squad 2</button>
            <button id="squad3" class="squadBtn">Squad 3</button>
            <button id="squad4" class="squadBtn">Squad 4</button>
        </p>
    </div>
    <button id="submitSelection">Submit Selection</button>

    <script defer type="module">
        // import statements remain unchanged
     import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
        import { getDatabase, ref, set, get, child, increment } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC_VKdV-KsIzUiOb7jFLsYXdTsuGkLiS-Q",
            authDomain: "register-71bde.firebaseapp.com",
            projectId: "register-71bde",
            storageBucket: "register-71bde.appspot.com",
            messagingSenderId: "412548441298",
            appId: "1:412548441298:web:e0fb2b6c5fbd4af7d0b90b"
        };
        // Firebase configuration remains unchanged

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const realtimeDb = getDatabase(app);

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById("userName").textContent = user.displayName;
                document.getElementById("userEmail").textContent = user.email;
                document.getElementById("userProfilePicture").src = user.photoURL;

                const squadButtons = document.querySelectorAll('.squadBtn');
                const submitBtn = document.getElementById('submitSelection');
                let selectedSquad = '';

                squadButtons.forEach((btn) => {
                    btn.addEventListener('click', () => {
                        selectedSquad = btn.id;
                        squadButtons.forEach((b) => {
                            if (b.id !== selectedSquad) {
                                b.disabled = true;
                            }
                        });
                    });
                });

                submitBtn.addEventListener('click', async () => {
                    const gameName = document.getElementById('gameName').value;
                    const gameId = document.getElementById('gameId').value;

                    if (gameName && gameId && selectedSquad) {
                        const userSquadRef = ref(realtimeDb, `userSquads/${user.uid}`);
                        const userSquadSnapshot = await get(child(userSquadRef, 'selectedSquad'));

                        if (userSquadSnapshot.exists()) {
                            alert("You have already submitted a squad selection.");
                        } else {
                            set(ref(realtimeDb, `userSquads/${user.uid}/selectedSquad`), selectedSquad);
                            alert("Squad selection submitted successfully!");
                            
                            // Redirect to a new page after successful submission
                            window.location.href = 'newPage.html'; // Replace 'newPage.html' with the desired target page
                        }
                    } else {
                        alert("Please enter game name, game ID, and select a squad before submitting");
                    }
                });
            } else {
                // Handle when user is not authenticated
            }
        });
    </script>
</body>
</html>