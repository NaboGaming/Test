<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Dashboard</title>
</head>
<body>
  <h1>Welcome to your Dashboard, <span id="userName"></span></h1>
  <p>Email: <span id="userEmail"></span></p>
  <img id="userProfilePicture" src="" alt="Profile Picture">
  <p>Enter your Game Name: <input type="text" id="gameName"></p>
  <p>Select your Squad:
      <select id="squadSelect">
          <option value="">Select Squad</option>
          <option value="squad1">Squad 1</option>
          <option value="squad2">Squad 2</option>
          <option value="squad3">Squad 3</option>
          <option value="squad4">Squad 4</option>
          <option value="squad5">Squad 5</option>
      </select>
      <button id="submitSquadBtn">Submit</button>
  </p>
  <script defer type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
      import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
      import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";
      const firebaseConfig = {
        // Your Firebase configuration
      };
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const realtimeDb = getDatabase(app);
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          document.getElementById("userName").textContent = user.displayName;
          document.getElementById("userEmail").textContent = user.email;
          document.getElementById("userProfilePicture").src = user.photoURL;

          const squadSelect = document.getElementById("squadSelect");
          const submitSquadBtn = document.getElementById("submitSquadBtn");
          submitSquadBtn.addEventListener('click', async () => {
            const selectedSquad = squadSelect.value;
            const gameName = document.getElementById("gameName").value;
            if (selectedSquad && gameName) {
              const userSquadRef = ref(realtimeDb, `userSquads/${user.uid}`);
              const userSquadSnapshot = await get(child(userSquadRef, 'selectedSquad'));
              if (userSquadSnapshot.exists()) {
                alert("You have already submitted a squad selection.");
              } else {
                set(ref(realtimeDb, `userSquads/${user.uid}`), {
                  selectedSquad: selectedSquad,
                  gameName: gameName
                });
                alert("Squad selection and game name submitted successfully!");
              }
            } else {
              alert("Please enter your game name and select a squad before submitting");
            }
          });
        } else {
          // Handle when the user is not logged in
        }
      });
  </script>
</body>
</html>