<!DOCTYPE html>
<html>
<head>
  <title>Firebase Phone Auth</title>
  <script defer type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
    import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
    
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC_VKdV-KsIzUiOb7jFLsYXdTsuGkLiS-Q",
      authDomain: "register-71bde.firebaseapp.com",
      projectId: "register-71bde",
      storageBucket: "register-71bde.appspot.com",
      messagingSenderId: "412548441298",
      appId: "1:412548441298:web:e0fb2b6c5fbd4af7d0b90b"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Render reCAPTCHA
    function render() {
      window.recaptchaVerifier = new RecaptchaVerifier('recaptcha-container', {
        'size': 'invisible',
        'callback': (response) => {
          // reCAPTCHA solved - will proceed with signInWithPhoneNumber
          phoneAuth();
        }
      }, auth);
      recaptchaVerifier.render();
    }

    // Function for sending SMS
    function phoneAuth() {
      const number = document.getElementById('number').value;
      const appVerifier = window.recaptchaVerifier;
      signInWithPhoneNumber(auth, number, appVerifier)
        .then((confirmationResult) => {
          window.confirmationResult = confirmationResult;
          document.getElementById('sender').style.display = 'none';
          document.getElementById('verifier').style.display = 'block';
        })
        .catch((error) => {
          alert(error.message);
        });
    }

    // Function for code verification
    function codeverify() {
      const code = document.getElementById('verificationcode').value;
      confirmationResult.confirm(code)
        .then((result) => {
          document.getElementsByClassName('p-conf')[0].style.display = 'block';
          document.getElementsByClassName('n-conf')[0].style.display = 'none';
        })
        .catch((error) => {
          document.getElementsByClassName('p-conf')[0].style.display = 'none';
          document.getElementsByClassName('n-conf')[0].style.display = 'block';
        });
    }

    // Make render and phoneAuth accessible globally
    window.render = render;
    window.phoneAuth = phoneAuth;
    window.codeverify = codeverify;
  </script>
</head>
<body onload="render()">
  <div id="recaptcha-container"></div>
  <div id="sender">
    <input type="text" id="number" placeholder="Enter phone number">
    <button onclick="phoneAuth()">Send SMS</button>
  </div>
  <div id="verifier" style="display:none;">
    <input type="text" id="verificationcode" placeholder="Enter verification code">
    <button onclick="codeverify()">Verify Code</button>
  </div>
  <div class="p-conf" style="display:none;">Phone number successfully verified!</div>
  <div class="n-conf" style="display:none;">Verification failed. Please try again.</div>
</body>
</html>
